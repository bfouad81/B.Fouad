<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cargo Acceptance & Receiving Form</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.umd.min.js"></script>

<style>
:root{
  --red-main:#c62828;
  --red-soft:#f6eaea;
  --border-soft:#ddd;
}
*{box-sizing:border-box;}
body{margin:0;padding:0;background:#f2f2f2;font-family:Arial,sans-serif;color:#000;}
.form-container{
  max-width:1200px;
  margin:0 auto;
  padding:10px 15px;
  background:#fff;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 8px 25px rgba(0,0,0,0.08);
}

/* HEADER */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  padding:15px 20px;
  background:#fff;
  border-bottom:4px solid var(--red-main);
}
.logo img{
  max-width:100%; max-height:70px; object-fit:contain;
}
.header-text{flex:1;text-align:right;}
.header-text h2{margin:0;color:var(--red-main);}
.header-text p{margin:5px 0 0;opacity:0.9;text-align:right;}
@media(max-width:900px){
  .header{flex-direction:column;align-items:center;text-align:center;}
  .header-text{text-align:center;margin-top:10px;}
}

/* Sections */
.section{padding:20px;border-bottom:1px solid var(--border-soft); page-break-inside:avoid;}
.section-title{
  display:block;
  width:100%;
  padding:10px 20px;
  font-weight:bold;
  color:#fff;
  background-color:var(--red-main);
  border-radius:12px;
  margin-bottom:15px;
  font-size:16px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

/* Grid */
.row{display:grid;grid-template-columns:repeat(12,1fr);gap:15px;}
.col-1{grid-column:span 1}.col-2{grid-column:span 2}.col-3{grid-column:span 3}
.col-4{grid-column:span 4}.col-5{grid-column:span 5}.col-6{grid-column:span 6}
.col-8{grid-column:span 8}.col-12{grid-column:span 12}

/* Fields */
label{font-size:13px;font-weight:bold;}
input,select,textarea{width:100%;padding:9px;margin-top:6px;border:1px solid var(--border-soft);border-radius:6px;transition:.2s}
textarea{resize:vertical}
input.filled,select.filled,textarea.filled{background:var(--red-soft);border-color:var(--red-main);}

/* Signature */
.signature-box{border:1px dashed var(--border-soft);border-radius:6px;height:160px;}
.clear-btn{margin-top:6px;padding:5px 10px;border:none;background:#eee;cursor:pointer;}
.submit-btn{width:100%;padding:18px;border:none;background:var(--red-main);color:#fff;font-size:16px;cursor:pointer;}

/* Hide in PDF */
.hide-in-pdf{display:block;}
@media print{
  .hide-in-pdf{display:none !important;}
}

/* Responsive */
@media(max-width:900px){
  .col-1,.col-2,.col-3,.col-4,.col-5,.col-6,.col-8{grid-column:span 12 !important;}
}
</style>
</head>

<body>
<div class="form-container">

<!-- HEADER -->
<div class="header">
  <div class="logo">
    <img src="https://raw.githubusercontent.com/bfouad81/logo/refs/heads/main/New%20Bitmap%20image.bmp" alt="Company Logo">
  </div>
  <div class="header-text">
    <h2>Cargo Acceptance & Receiving Form</h2>
  </div>
</div>

<!-- CUSTOMER -->
<div class="section">
<div class="section-title">Customer / Shipper</div>
<div class="row">
  <div class="col-4"><label>Name *</label><input id="customerName" required></div>
  <div class="col-4"><label>Phone *</label><input id="customerPhone" required></div>
  <div class="col-4"><label>Address *</label><input id="customerAddress" required></div>
  <div class="col-4"><label>Email</label><input id="customerEmail" type="email"></div>
</div>
</div>

<!-- CONSIGNEE -->
<div class="section">
<div class="section-title">Consignee / Receiver</div>
<div class="row">
  <div class="col-4"><label>Name *</label><input id="consigneeName" required></div>
  <div class="col-4"><label>Phone *</label><input id="consigneePhone" required></div>
  <div class="col-4"><label>Address *</label><input id="consigneeAddress" required></div>
  <div class="col-4"><label>Email</label><input id="consigneeEmail" type="email"></div>
  <div class="col-4"><label>Company Name (if any)</label><input id="consigneeCompany"></div>
</div>
</div>

<!-- SHIPMENT -->
<div class="section">
<div class="section-title">Shipment Details</div>
<div class="row">
  <div class="col-6"><label>Mode of Transport *</label>
    <select id="transportMode" required>
      <option value="">Select</option><option>Land</option><option>Air</option><option>Sea</option>
    </select>
  </div>
  <div class="col-6"><label>Shipment Type *</label>
    <select id="shipmentType" required>
      <option value="">Select</option><option>LTL</option><option>FTL</option><option>Courier</option><option>Other</option>
    </select>
  </div>
</div>
</div>

<!-- CARGO -->
<div class="section">
<div class="section-title">Cargo Description (As Declared by Shipper)</div>
<p class="note">All information below is as declared by the shipper. Actual weight & CBM may differ.</p>
<div class="row">
  <div class="col-12 col-md-6"><label>Description *</label><input id="goodsDescription" required></div>
  <div class="col-12 col-md-3"><label>Packaging *</label>
    <select id="packagingType" required>
      <option value="">Select</option>
      <option>Box</option><option>Pallet</option><option>Wooden Crate</option><option>Drum</option><option>Bag</option>
    </select>
  </div>
  <div class="col-4 col-md-1"><label>Pkgs *</label><input id="packages" type="number" required></div>
  <div class="col-4 col-md-1"><label>KG *</label><input id="declaredWeight" type="number" required></div>
  <div class="col-4 col-md-1"><label>CBM *</label><input id="cbm" type="number" step="0.01" required></div>
</div>
</div>

<!-- DOCUMENTS -->
<div class="section hide-in-pdf">
<div class="section-title">Documents Upload (Optional)</div>
<div class="row">
  <div class="col-4"><label>Invoice</label><input type="file"></div>
  <div class="col-4"><label>Packing List</label><input type="file"></div>
  <div class="col-4"><label>CMR / Waybill</label><input type="file"></div>
  <div class="col-4"><label>Certificate of Origin</label><input type="file"></div>
  <div class="col-4"><label>MSDS</label><input type="file"></div>
  <div class="col-4"><label>Other</label><input type="file"></div>
</div>
</div>

<!-- SIGNATURE -->
<div class="section">
<div class="section-title">Declaration & Signatures</div>
<p class="note">
I hereby confirm that the above shipment has been handed over by the customer and
received by the logistics company in the stated condition and quantity for shipment
to the final destination.
</p>
<div class="row">
  <div class="col-6">
    <label>Customer Signature</label>
    <canvas id="sigCustomer" class="signature-box"></canvas>
    <button class="clear-btn hide-in-pdf" onclick="sigCustomer.clear()">Clear</button>
  </div>
  <div class="col-6">
    <label>Company Signature</label>
    <canvas id="sigCompany" class="signature-box"></canvas>
    <button class="clear-btn hide-in-pdf" onclick="sigCompany.clear()">Clear</button>
  </div>
</div>
</div>

<!-- SAVE PDF BUTTON -->
<div class="section hide-in-pdf">
  <button type="button" id="savePdfBtn" class="submit-btn">Save as PDF</button>
  <button type="button" id="sendEmailBtn" class="submit-btn" style="margin-top:10px;background:#2e7d32;">Send Email</button>
</div>

</div>

<script>
// SIGNATURE
const sigCustomer=new SignaturePad(document.getElementById("sigCustomer"));
const sigCompany=new SignaturePad(document.getElementById("sigCompany"));

// HIGHLIGHT FILLED
document.querySelectorAll("input,select,textarea").forEach(el=>{
  el.addEventListener("change",()=>{
    if(el.value || el.files?.length) el.classList.add("filled");
    else el.classList.remove("filled");
  });
});

// SAVE PDF
document.getElementById('savePdfBtn').addEventListener('click', function() {
    // Hide elements before PDF generation
    document.querySelectorAll('.hide-in-pdf').forEach(el => {
      el.style.display = 'none';
    });
    
    const element = document.querySelector('.form-container');
    const opt = {
      margin:10,
      filename:'Cargo_Form.pdf',
      image:{ type:'jpeg', quality:0.98 },
      html2canvas:{ scale:2, scrollY:0 },
      jsPDF:{ unit:'mm', format:'a4', orientation:'portrait' },
      pagebreak:{ mode:['avoid-all','css'] }
    };
    
    html2pdf().set(opt).from(element).save().then(() => {
      // Show elements again after PDF is generated
      document.querySelectorAll('.hide-in-pdf').forEach(el => {
        el.style.display = '';
      });
    });
});

// SEND EMAIL
document.getElementById('sendEmailBtn').addEventListener('click', async function() {
  // Collect form data
  const formData = {
    customerName: document.getElementById('customerName').value,
    customerPhone: document.getElementById('customerPhone').value,
    customerAddress: document.getElementById('customerAddress').value,
    customerEmail: document.getElementById('customerEmail').value,
    consigneeName: document.getElementById('consigneeName').value,
    consigneePhone: document.getElementById('consigneePhone').value,
    consigneeAddress: document.getElementById('consigneeAddress').value,
    consigneeEmail: document.getElementById('consigneeEmail').value,
    consigneeCompany: document.getElementById('consigneeCompany').value,
    transportMode: document.getElementById('transportMode').value,
    shipmentType: document.getElementById('shipmentType').value,
    goodsDescription: document.getElementById('goodsDescription').value,
    packagingType: document.getElementById('packagingType').value,
    packages: document.getElementById('packages').value,
    declaredWeight: document.getElementById('declaredWeight').value,
    cbm: document.getElementById('cbm').value
  };

  try {
    this.disabled = true;
    this.textContent = 'Converting to PDF...';
    
    // Hide elements before PDF generation
    document.querySelectorAll('.hide-in-pdf').forEach(el => {
      el.style.display = 'none';
    });
    
    // Generate PDF
    const element = document.querySelector('.form-container');
    const opt = {
      margin: 10,
      filename: 'Cargo_Form.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2, scrollY: 0 },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
      pagebreak: { mode: ['avoid-all', 'css'] }
    };
    
    const pdf = await html2pdf().set(opt).from(element).outputPdf('dataurlstring');
    
    // Show elements again
    document.querySelectorAll('.hide-in-pdf').forEach(el => {
      el.style.display = '';
    });
    
    this.textContent = 'Sending...';
    
    const response = await fetch('https://script.google.com/macros/s/AKfycbx2aTfDF-rA4Y8CX1z61GmOT9e0LNs3hODEQOqClDcZRyRM8PJ4iEdoeXdw_veNdcnzhw/exec', {
      method: 'POST',
      body: new URLSearchParams({
        data: JSON.stringify(formData),
        pdfFile: pdf
      })
    });
    
    alert('Form submitted successfully! Email sent with PDF attachment.');
    this.textContent = 'Send Email';
    
    // Clear all form fields
    document.querySelectorAll("input, select, textarea").forEach(el => {
      if(el.type === 'file') {
        el.value = '';
      } else if(el.type === 'checkbox' || el.type === 'radio') {
        el.checked = false;
      } else {
        el.value = '';
      }
      el.classList.remove('filled');
    });
    
    // Clear signatures
    sigCustomer.clear();
    sigCompany.clear();
    
    // Clear localStorage
    localStorage.clear();
    
    // Scroll to top
    window.scrollTo({top: 0, behavior: 'smooth'});
    
  } catch (error) {
    alert('Error submitting form: ' + error.message);
    this.textContent = 'Send Email';
  } finally {
    this.disabled = false;
  }
});

// AUTO SAVE EVERY 2 MINUTES
setInterval(() => {
  document.querySelectorAll("input, select, textarea").forEach(el => {
    if(el.type==='file') return;
    localStorage.setItem(el.id, el.value);
  });
  localStorage.setItem('sigCustomer', sigCustomer.toDataURL());
  localStorage.setItem('sigCompany', sigCompany.toDataURL());
}, 120000);

// LOAD DATA ON PAGE LOAD
window.addEventListener('load', () => {
  document.querySelectorAll("input, select, textarea").forEach(el => {
    if(el.type==='file') return;
    if(localStorage.getItem(el.id)) el.value = localStorage.getItem(el.id);
  });

  if(localStorage.getItem('sigCustomer')){
    const img = new Image(); img.src = localStorage.getItem('sigCustomer');
    img.onload = () => sigCustomer.fromDataURL(img.src);
  }
  if(localStorage.getItem('sigCompany')){
    const img = new Image(); img.src = localStorage.getItem('sigCompany');
    img.onload = () => sigCompany.fromDataURL(img.src);
  }
});
</script>

</body>
</html>
